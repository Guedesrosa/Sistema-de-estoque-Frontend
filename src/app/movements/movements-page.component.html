<div class="grid cols-2">
  <div class="card">
    <h2>ğŸ“¥ Registrar MovimentaÃ§Ã£o</h2>
    <form class="form" [formGroup]="form" (ngSubmit)="salvar()">
      <div class="row two">
        <div>
          <label>Produto *</label>
          <select formControlName="produtoId">
            <option value="" disabled>Selecione um produto</option>
            <option *ngFor="let p of produtos" [value]="p.id">
              {{p.nome}} (Estoque: {{p.quantidadeEstoque}})
            </option>
          </select>
        </div>
        <div>
          <label>Tipo de MovimentaÃ§Ã£o *</label>
          <select formControlName="tipo">
            <option value="ENTRADA">ğŸ“¥ Entrada</option>
            <option value="SAIDA">ğŸ“¤ SaÃ­da</option>
          </select>
        </div>
      </div>
      <div class="row two">
        <div>
          <label>Data da MovimentaÃ§Ã£o *</label>
          <input type="date" formControlName="data">
        </div>
        <div>
          <label>Quantidade *</label>
          <input type="number" min="1" placeholder="Quantidade" formControlName="quantidade">
        </div>
      </div>
      <div *ngIf="form.value.produtoId && form.value.quantidade && form.value.tipo" class="info-box" 
           [class.warning]="form.value.tipo === 'SAIDA' && isAbaixoMinimo()"
           [class.info]="form.value.tipo === 'ENTRADA' && isAcimaMaximo()">
        <div *ngIf="form.value.tipo === 'SAIDA'">
          <strong>âš ï¸ AtenÃ§Ã£o:</strong> ApÃ³s esta saÃ­da, o estoque serÃ¡ de 
          <strong>{{getEstoqueAposMovimentacao()}}</strong> unidades.
          <div *ngIf="isAbaixoMinimo()" style="margin-top: 8px; color: var(--danger);">
            âš ï¸ O estoque ficarÃ¡ abaixo da quantidade mÃ­nima!
          </div>
        </div>
        <div *ngIf="form.value.tipo === 'ENTRADA'">
          <strong>â„¹ï¸ InformaÃ§Ã£o:</strong> ApÃ³s esta entrada, o estoque serÃ¡ de 
          <strong>{{getEstoqueAposMovimentacao()}}</strong> unidades.
          <div *ngIf="isAcimaMaximo()" style="margin-top: 8px; color: var(--warning);">
            âš ï¸ O estoque ficarÃ¡ acima da quantidade mÃ¡xima!
          </div>
        </div>
      </div>
      <div class="row">
        <button type="submit" [disabled]="form.invalid" style="width: 100%;">
          ğŸ’¾ Registrar MovimentaÃ§Ã£o
        </button>
      </div>
    </form>
  </div>
  <div class="card">
    <h2>ğŸ“Š HistÃ³rico de MovimentaÃ§Ãµes</h2>
    <div class="toolbar">
      <input class="search" type="text" placeholder="ğŸ” Buscar por produto..." [(ngModel)]="search" (input)="applyFilter()">
      <div class="pagination">
        <button class="secondary small" (click)="page=Math.max(1,page-1);applyFilter()" [disabled]="page === 1">â—€ Anterior</button>
        <span>PÃ¡gina {{page}} de {{getTotalPages()}}</span>
        <button class="secondary small" (click)="page=page+1;applyFilter()" [disabled]="page * pageSize >= items.length">PrÃ³xima â–¶</button>
      </div>
    </div>
    <div *ngIf="filtered.length === 0" class="empty-state">
      <h3>Nenhuma movimentaÃ§Ã£o encontrada</h3>
      <p>{{search ? 'Tente ajustar sua busca' : 'Registre sua primeira movimentaÃ§Ã£o'}}</p>
    </div>
    <table class="table" *ngIf="filtered.length > 0">
      <thead>
      <tr>
        <th>Produto</th>
        <th>Data</th>
        <th>Tipo</th>
        <th>Quantidade</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let i of filtered">
        <td><strong>{{i.produto?.nome || 'Produto nÃ£o encontrado'}}</strong></td>
        <td>{{i.data ? (i.data | date:'dd/MM/yyyy') : '-'}}</td>
        <td>
          <span class="status-badge" [class.entrada]="i.tipo === 'ENTRADA'" [class.saida]="i.tipo === 'SAIDA'">
            {{i.tipo === 'ENTRADA' ? 'ğŸ“¥ Entrada' : 'ğŸ“¤ SaÃ­da'}}
          </span>
        </td>
        <td><strong>{{i.quantidade}}</strong></td>
      </tr>
      </tbody>
    </table>
  </div>
</div>